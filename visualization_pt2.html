<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Visualization with ggplot2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
<script defer src="https://use.fontawesome.com/releases/v5.0.3/js/all.js"></script>
<script defer src="https://use.fontawesome.com/releases/v5.0.0/js/v4-shims.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">P8105</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="topic_what_is_data_science.html">What is Data Science?</a>
    </li>
    <li>
      <a href="topic_building_blocks.html">Building Blocks</a>
    </li>
    <li>
      <a href="topic_data_wrangling_i.html">Data Wrangling I</a>
    </li>
    <li>
      <a href="topic_visualization_and_eda.html">Visualization and EDA</a>
    </li>
    <li>
      <a href="topic_data_wrangling_ii.html">Data Wrangling II</a>
    </li>
    <li>
      <a href="topic_interactivity.html">Interactivity</a>
    </li>
    <li>
      <a href="topic_resampling.html">Resampling</a>
    </li>
    <li>
      <a href="topic_linear_models.html">Linear Models</a>
    </li>
    <li>
      <a href="topic_other_material.html">Other Materials</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Datasets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="dataset_airbnb.html">Airbnb</a>
    </li>
    <li>
      <a href="dataset_brfss.html">BRFSS</a>
    </li>
    <li>
      <a href="dataset_fivethirtyeight.html">FiveThirtyEight</a>
    </li>
    <li>
      <a href="dataset_instacart.html">Instacart</a>
    </li>
    <li>
      <a href="dataset_mr_trash_wheel.html">Mr. Trash Wheel</a>
    </li>
    <li>
      <a href="dataset_noaa.html">NOAA</a>
    </li>
    <li>
      <a href="dataset_restaurant_inspections.html">NYC Restaurant Inspections</a>
    </li>
  </ul>
</li>
<li>
  <a href="homework_and_projects.html">Homework and Projects</a>
</li>
<li>
  <a href="course_communication.html">Communication</a>
</li>
<li>
  <a href="https://github.com/P8105/p8105.github.io">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Visualization with <code>ggplot2</code></h1>
<h3 class="subtitle"><em>Part 2</em></h3>

</div>


<p>Good visualization is a critical step in data analysis.</p>
<p>This is the second module in the <a href="topic_visualization_and_eda.html">Visualization and EDA</a> topic; the relevant slack channel is <a href="https://p8105-fall2018.slack.com/messages/CCCBZPUVC">here</a>. Note that the slides and Other Materials / Extra Reading is the same as in <a href="visualization_pt1.html">Visualization Pt 1</a>.</p>
<div id="some-slides" class="section level2">
<h2>Some slides</h2>
<script async class="speakerdeck-embed" data-id="7272d2325e0d4f27a6bca25afbf149ce" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
<div style="margin-bottom:5px">
<strong> <a href="https://speakerdeck.com/jeffgoldsmith/dsi-visualization" title="Visualization" target="_blank">Visualization</a> </strong> from <strong><a href="https://speakerdeck.com/jeffgoldsmith" target="_blank">Jeff Goldsmith</a></strong>.
</div>
<p><br></p>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>Although I could add to the same .Rmd I started in <a href="visualization_pt1.html">Visualization Pt 1</a>, I’ll create a new document for today. We’re also going to take advantage of features in additional packages; most of these were installed previously, but you might need to install some others using the code below:</p>
<pre class="r"><code>devtools::install_github(&quot;thomasp85/patchwork&quot;)</code></pre>
<p>Next I’ll load the relevant packages.</p>
<pre class="r"><code>library(tidyverse)
## ── Attaching packages ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──
## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.6
## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
## ✔ readr   1.1.1     ✔ forcats 0.3.0
## ── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
library(ggridges)
## 
## Attaching package: &#39;ggridges&#39;
## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     scale_discrete_manual
library(ggthemes)
library(patchwork)</code></pre>
<p>We’ll still work with NOAA weather data, which is loaded using the same code as in <a href="visualization_pt1.html">Visualization Pt 1</a>.</p>
<pre class="r"><code>library(rnoaa)

weather_df = 
  rnoaa::meteo_pull_monitors(c(&quot;USW00094728&quot;, &quot;USC00519397&quot;, &quot;USS0023B17S&quot;),
                      var = c(&quot;PRCP&quot;, &quot;TMIN&quot;, &quot;TMAX&quot;), 
                      date_min = &quot;2017-01-01&quot;,
                      date_max = &quot;2017-12-31&quot;) %&gt;%
  mutate(
    name = recode(id, USW00094728 = &quot;CentralPark_NY&quot;, 
                      USC00519397 = &quot;Waikiki_HA&quot;,
                      USS0023B17S = &quot;Waterhole_WA&quot;),
    tmin = tmin / 10,
    tmax = tmax / 10) %&gt;%
  select(name, id, everything())
weather_df
## # A tibble: 1,095 x 6
##    name           id          date        prcp  tmax  tmin
##    &lt;chr&gt;          &lt;chr&gt;       &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 CentralPark_NY USW00094728 2017-01-01     0   8.9   4.4
##  2 CentralPark_NY USW00094728 2017-01-02    53   5     2.8
##  3 CentralPark_NY USW00094728 2017-01-03   147   6.1   3.9
##  4 CentralPark_NY USW00094728 2017-01-04     0  11.1   1.1
##  5 CentralPark_NY USW00094728 2017-01-05     0   1.1  -2.7
##  6 CentralPark_NY USW00094728 2017-01-06    13   0.6  -3.8
##  7 CentralPark_NY USW00094728 2017-01-07    81  -3.2  -6.6
##  8 CentralPark_NY USW00094728 2017-01-08     0  -3.8  -8.8
##  9 CentralPark_NY USW00094728 2017-01-09     0  -4.9  -9.9
## 10 CentralPark_NY USW00094728 2017-01-10     0   7.8  -6  
## # ... with 1,085 more rows</code></pre>
<p>As a starting point, we’ll revisit the scatterplot of <code>tmax</code> against <code>tmin</code> made in <a href="visualization_pt1.html">Visualization Pt 1</a>.</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5)
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-4-1.png" width="90%" /></p>
<div id="labels-etc" class="section level3">
<h3>Labels etc</h3>
<p>Some of the most important are the axis labels, title, and caption, all of which can be controlled using <code>labs()</code>.</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  )
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-5-1.png" width="90%" /></p>
<p>Tick marks and labels.</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  ) + 
  scale_x_continuous(breaks = c(-15, 0, 15), 
                     labels = c(&quot;-15º C&quot;, &quot;0&quot;, &quot;15&quot;))
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-6-1.png" width="90%" /></p>
<p>Other <code>scale_x</code> and <code>scale_y</code> options</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  ) + 
  scale_x_continuous(breaks = c(-15, 0, 15), 
                     labels = c(&quot;-15ºC&quot;, &quot;0&quot;, &quot;15&quot;),
                     limits = c(-20, 30)) + 
  scale_y_continuous(trans = &quot;sqrt&quot;, 
                     position = &quot;right&quot;)
## Warning in self$trans$transform(x): NaNs produced
## Warning: Transformation introduced infinite values in continuous y-axis
## Warning: Removed 90 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-7-1.png" width="90%" /></p>
</div>
<div id="colors-and-themes" class="section level3">
<h3>Colors and themes</h3>
<p>Lots of scale options for other aesthetics. Color comes up a lot.</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  ) + 
  scale_color_hue(name = &quot;Location&quot;, 
                  h = c(100, 300))
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-8-1.png" width="90%" /></p>
<p>Trying to create your own color scheme usually doesn’t go well; I encourage you to use the <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html"><code>viridis</code></a> package instead.</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  ) + 
  viridis::scale_color_viridis(
    name = &quot;Location&quot;, 
    discrete = TRUE
  )
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-9-1.png" width="90%" /></p>
<p>We used <code>discrete = TRUE</code> because the color aesthetic is mapped to a discrete variable. In other cases (for example, when color mapped to <code>prcp</code>) you can omit this and get a continuous color gradient. The <code>viridis::scale_fill_viridis</code> is appropriate for the <code>fill</code> aesthetic.</p>
<p>Another that I frequently change is the legend position; by default this is on the right of the graphic, but I often shift it to the bottom to ensure the graphic takes up the available left-to-right space.</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  ) + 
  viridis::scale_color_viridis(
    name = &quot;Location&quot;, 
    discrete = TRUE
  ) + 
  theme(legend.position = &quot;bottom&quot;)
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-10-1.png" width="90%" /></p>
<p><code>legend.position = &quot;none&quot;</code> will remove the legend.</p>
<p>While we’re on the subject, you can change the default theme (which is <code>theme_gray</code>) to something else. Here’s <code>theme_bw()</code>:</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  ) + 
  viridis::scale_color_viridis(
    name = &quot;Location&quot;, 
    discrete = TRUE
  ) + 
  theme_bw() + 
  theme(legend.position = &quot;bottom&quot;)
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-11-1.png" width="90%" /></p>
<p>… and here’s <code>theme_classic()</code>:</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  ) + 
  viridis::scale_color_viridis(
    name = &quot;Location&quot;, 
    discrete = TRUE
  ) + 
  theme_classic() + 
  theme(legend.position = &quot;bottom&quot;)
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-12-1.png" width="90%" /></p>
<p>… and, for some reason, here’s the Excel 2003 theme from <a href="https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html"><code>ggthemes</code></a>:</p>
<pre class="r"><code>ggplot(weather_df, aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = .5) + 
  labs(
    title = &quot;Temperature plot&quot;,
    x = &quot;Minimum daily temperature (C)&quot;,
    y = &quot;Maxiumum daily temperature (C)&quot;,
    caption = &quot;Data from the rnoaa package&quot;
  ) + 
  viridis::scale_color_viridis(
    name = &quot;Location&quot;, 
    discrete = TRUE
  ) + 
  ggthemes::theme_excel() + 
  theme(legend.position = &quot;bottom&quot;)
## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-13-1.png" width="90%" /></p>
<p>Don’t use the Excel 2003 theme (the first two are fine, and <code>ggthemes</code> has other very nice themes as well).</p>
<p>The ordering of <code>theme_bw()</code> and <code>theme()</code> matters – <code>theme()</code> changes a particular element of the plot’s “theme”. If you call <code>theme</code> to change the theme and then <code>theme_bw()</code>, and updates are overwritten by <code>theme_bw()</code>.</p>
<p><strong><em>Learning Assessment:</em></strong> Revisit to density plot you made comparing precipitation across locations. Use themes and labels to improve the readability of this plot.</p>
</div>
<div id="setting-options" class="section level3">
<h3>Setting options</h3>
<p>In addition to figure sizing, I include a lot of my preferences in global options declared at the outset of each .Rmd file (this just gets copy-and-pasted everywhere).</p>
<pre class="r"><code>library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = &quot;90%&quot;
)

theme_set(theme_bw() + theme(legend.position = &quot;bottom&quot;))</code></pre>
</div>
<div id="geom-data-argument" class="section level3">
<h3><code>geom</code> data argument</h3>
<p>We talked a bit about aesthetics being set globally vs locally. You can do a similar thing with data (this is a contrived example):</p>
<pre class="r"><code>central_park = 
  weather_df %&gt;% 
  filter(name == &quot;CentralPark_NY&quot;)

waikiki = 
  weather_df %&gt;% 
  filter(name == &quot;Waikiki_HA&quot;)

ggplot(waikiki, aes(x = date, y = tmax, color = name)) + 
  geom_point() + 
  geom_line(data = central_park)
## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-15-1.png" width="90%" /></p>
</div>
<div id="patchwork" class="section level3">
<h3><code>patchwork</code></h3>
<p>Facetting works if you want the “same plot” for several levels of a category. Sometimes you want to show three completely different plots.</p>
<pre class="r"><code>p1 = ggplot(weather_df, aes(x = tmax, y = tmin, color = name)) + 
  geom_point(alpha = .5) +
  theme(legend.position = &quot;none&quot;)

p2 = weather_df %&gt;% 
  filter(prcp &gt; 0) %&gt;% 
  ggplot(aes(x = prcp, fill = name)) + 
  geom_density(alpha = .5) + 
  theme(legend.position = &quot;none&quot;)

p3 = ggplot(weather_df, aes(x = date, y = tmax, color = name)) + 
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) + 
  theme(legend.position = &quot;bottom&quot;)

(p1 + p2) / p3
## Warning: Removed 15 rows containing missing values (geom_point).
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## Warning: Removed 3 rows containing non-finite values (stat_smooth).
## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-16-1.png" width="90%" /></p>
</div>
<div id="data-manipulation" class="section level3">
<h3>Data Manipulation</h3>
<p>Data manip is part of plotting.</p>
<p>The behavior of your plot depends on the data you’ve supplied; in some cases, it’s easier to control behavior through data manipulation than it is through the plot code. This is particularly true for the order of categorical or factor variables. Categorical variables will be ordered alphabetically; factors will be follow the specified order level. You can change the order level of a factor variable to your specified preference using <code>forcats::fct_relevel</code> or according to the value of another variable using <code>forcats::fct_reorder</code>.</p>
<pre class="r"><code>weather_df %&gt;%
  mutate(name = forcats::fct_relevel(name, c(&quot;Waikiki_HA&quot;, &quot;CentralPark_NY&quot;, &quot;Waterhole_WA&quot;))) %&gt;% 
  ggplot(aes(x = name, y = tmax)) + 
  geom_violin(aes(fill = name), color = &quot;blue&quot;, alpha = .5) + 
  theme(legend.position = &quot;bottom&quot;)
## Warning: Removed 3 rows containing non-finite values (stat_ydensity).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-17-1.png" width="90%" /></p>
<pre class="r"><code>weather_df %&gt;%
  mutate(name = forcats::fct_reorder(name, tmax)) %&gt;% 
  ggplot(aes(x = name, y = tmax)) + 
  geom_violin(aes(fill = name), color = &quot;blue&quot;, alpha = .5) + 
  theme(legend.position = &quot;bottom&quot;)
## Warning: Removed 3 rows containing non-finite values (stat_ydensity).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-18-1.png" width="90%" /></p>
<p>We’ll learn more about the <a href="http://forcats.tidyverse.org/index.html"><code>forcats</code></a> package in <a href="data_wrangling_ii.html">Data Wrangling II</a>.</p>
<p>More difficult example – suppose i wanted a three-panel plot showing the distribution of min and max temps in each location.</p>
<pre class="r"><code>weather_df %&gt;%
  select(name, tmax, tmin) %&gt;% 
  gather(key = observation, value = temp, tmax:tmin) %&gt;% 
  ggplot(aes(x = temp, fill = observation)) +
  geom_density(alpha = .5) + 
  facet_grid(~name) + 
  viridis::scale_fill_viridis(discrete = TRUE)
## Warning: Removed 18 rows containing non-finite values (stat_density).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-19-1.png" width="90%" /></p>
<p>Make a plot of pusle data</p>
<pre class="r"><code>pulse_data = haven::read_sas(&quot;./data/public_pulse_data.sas7bdat&quot;) %&gt;%
  janitor::clean_names() %&gt;%
  gather(key = visit, value = bdi, bdi_score_bl:bdi_score_12m) %&gt;%
  separate(visit, into = c(&quot;remove_1&quot;, &quot;remove_2&quot;, &quot;visit&quot;), sep = &quot;_&quot;) %&gt;%
  select(id, visit, everything(), -starts_with(&quot;remove&quot;)) %&gt;%
  mutate(visit = replace(visit, visit == &quot;bl&quot;, &quot;00m&quot;),
         visit = factor(visit, levels = str_c(c(&quot;00&quot;, &quot;01&quot;, &quot;06&quot;, &quot;12&quot;), &quot;m&quot;))) %&gt;%
  arrange(id, visit)
## Warning: attributes are not identical across measure variables;
## they will be dropped

ggplot(pulse_data, aes(x = visit, y = bdi)) + 
  geom_boxplot()
## Warning: Removed 879 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-20-1.png" width="90%" /></p>
<p>Make a plot of FAS data</p>
<pre class="r"><code>pup_data = read_csv(&quot;./data/FAS_pups.csv&quot;, col_types = &quot;ciiiii&quot;) %&gt;%
  janitor::clean_names() %&gt;%
  mutate(sex = recode(sex, `1` = &quot;male&quot;, `2` = &quot;female&quot;)) 

litter_data = read_csv(&quot;./data/FAS_litters.csv&quot;, col_types = &quot;ccddiiii&quot;) %&gt;%
  janitor::clean_names() %&gt;%
  select(-pups_survive) %&gt;%
  separate(group, into = c(&quot;dose&quot;, &quot;day_of_tx&quot;), sep = 3) %&gt;%
  mutate(wt_gain = gd18_weight - gd0_weight,
         day_of_tx = as.numeric(day_of_tx))

fas_data = left_join(pup_data, litter_data, by = &quot;litter_number&quot;) 

fas_data %&gt;% 
  select(sex, dose, day_of_tx, pd_ears:pd_walk) %&gt;% 
  gather(key = outcome, value = pn_day, pd_ears:pd_walk) %&gt;% 
  na.omit() %&gt;% 
  mutate(outcome = forcats::fct_reorder(outcome, day_of_tx, median)) %&gt;% 
  ggplot(aes(x = dose, y = pn_day)) + 
  geom_violin() + 
  facet_grid(day_of_tx ~ outcome)</code></pre>
<p><img src="visualization_pt2_files/figure-html/unnamed-chunk-21-1.png" width="90%" /></p>
</div>
</div>
<div id="other-materials" class="section level2">
<h2>Other materials</h2>
<p>Oh man is there a lot of stuff about visualization …</p>
<ul>
<li>There are overviews on good and bad graphics
<ul>
<li>Including an early paper on <a href="http://www.jstor.org/stable/2683253?seq=1#page_scan_tab_contents">“How to display data badly”</a></li>
<li>Karl Broman’s <a href="https://www.biostat.wisc.edu/~kbroman/topten_worstgraphs/">top ten worst graphs</a></li>
<li>… and Karl’s talk on <a href="https://www.biostat.wisc.edu/~kbroman/presentations/graphs2017.pdf">creating effective figures and table</a></li>
<li>Also Hadley Wickham’s <a href="http://vita.had.co.nz/papers/layered-grammar.pdf">paper</a> on the philosophy underlying <code>ggplot</code></li>
</ul></li>
<li>There are tutorials on making graphics using <code>ggplot</code>
<ul>
<li>From R for Data Science: <a href="http://r4ds.had.co.nz/data-visualisation.html">basics</a> and <a href="and%20http://r4ds.had.co.nz/graphics-for-communication.html">advanced stuff</a></li>
<li>Jenny Bryan’s <a href="http://stat545.com/cm006_tibbles-dplyr-ggplot2.html">intro to ggplot</a> and her <a href="https://github.com/jennybc/ggplot2-tutorial">ggplot tutorial</a> (with a <a href="https://www.youtube.com/watch?v=4MfUCX_KpdE">video presentation</a> of the ggplot2 tutorial slides)</li>
<li>From <a href="https://geanders.github.io/RProgrammingForResearch/exploring-data-1.html#plots-to-explore-data">R Programming for Research</a></li>
<li>The <a href="http://www.cookbook-r.com/Graphs/">Graphs</a> chapter in the R Cookbook by Winston Chang</li>
<li>… and his <a href="http://shop.oreilly.com/product/0636920023135.do">R Graphics Cookbook</a></li>
<li>And, of course, a <a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf">cheatsheet</a></li>
</ul></li>
<li>There are arguments about ggplot vs base R graphics
<ul>
<li><a href="https://simplystatistics.org/2016/02/11/why-i-dont-use-ggplot2/">Why I don’t use ggplot2</a></li>
<li><a href="https://flowingdata.com/2016/03/22/comparing-ggplot2-and-r-base-graphics/">Comparing ggplot2 and R Base Graphics</a></li>
<li><a href="http://varianceexplained.org/r/why-I-use-ggplot2/">Why I use ggplot2</a></li>
</ul></li>
</ul>
<p>The code that I produced working examples in lecture is <a href="./lecture_code/visualization_and_eda.zip">here</a>.</p>
</div>

<br><br>
<footer>
  <img src="images/p8105_stickers.png" alt="stickers" style="width:30%">
  <br>
  <p class="copyright text-muted" align="center">Copyright &copy; 2018 Jeff Goldsmith</p>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
